import{$ as e,C as t,Dt as n,E as r,H as i,K as a,O as o,Tt as s,b as c,dt as l,g as u,gt as d,wt as f,yt as p}from"./vue.CAJL2k56.js";import{t as m}from"./tryOnScopeDispose.C50xVOZe.js";import{t as h}from"./createEventHook.CZiZk_fv.js";import{t as g}from"./toRefs.DDZFhd20.js";import{t as _}from"./unrefElement.BXTXpAEN.js";import{t as v}from"./Scrubber.ByoltvSW.js";var y=Object.defineProperty,b=Object.getOwnPropertySymbols,x=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable,C=(e,t,n)=>t in e?y(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,w=(e,t)=>{for(var n in t||={})x.call(t,n)&&C(e,n,t[n]);if(b)for(var n of b(t))S.call(t,n)&&C(e,n,t[n]);return e},T=()=>({emit(e,...t){for(let n=this.events[e]||[],r=0,i=n.length;r<i;r++)n[r](...t)},events:{},on(e,t){var n;return((n=this.events)[e]||(n[e]=[])).push(t),()=>{this.events[e]=this.events[e]?.filter(e=>t!==e)}}});function E(e,t){return e-t}function D(e){return e<0?-1:1}function O(e){return[Math.abs(e),D(e)]}function k(){let e=()=>((1+Math.random())*65536|0).toString(16).substring(1);return`${e()+e()}-${e()}-${e()}-${e()}-${e()}${e()}${e()}`}var A=2;function j(e,t){let n=document.createElementNS(`http://www.w3.org/2000/svg`,`defs`),r=document.createElementNS(`http://www.w3.org/2000/svg`,`marker`),i=document.createElementNS(`http://www.w3.org/2000/svg`,`path`);return i.setAttribute(`fill`,t),r.setAttribute(`id`,e),r.setAttribute(`viewBox`,`0 -5 10 10`),r.setAttribute(`refX`,`5`),r.setAttribute(`refY`,`0`),r.setAttribute(`markerWidth`,`4`),r.setAttribute(`markerHeight`,`4`),r.setAttribute(`orient`,`auto`),i.setAttribute(`d`,`M0,-5L10,0L0,5`),r.appendChild(i),n.appendChild(r),n}function M(e,t){let n=e.x-t.x,r=e.y-t.y;return n*n+r*r}function N(e,t,n){let r=t.x,i=t.y,a=n.x-r,o=n.y-i;if(a!==0||o!==0){let t=((e.x-r)*a+(e.y-i)*o)/(a*a+o*o);t>1?(r=n.x,i=n.y):t>0&&(r+=a*t,i+=o*t)}return a=e.x-r,o=e.y-i,a*a+o*o}function P(e,t){let n=e[0],r=[n],i;for(let a=1,o=e.length;a<o;a++)i=e[a],M(i,n)>t&&(r.push(i),n=i);return n!==i&&i&&r.push(i),r}function F(e,t,n,r,i){let a=r,o=0;for(let r=t+1;r<n;r++){let i=N(e[r],e[t],e[n]);i>a&&(o=r,a=i)}a>r&&(o-t>1&&F(e,t,o,r,i),i.push(e[o]),n-o>1&&F(e,o,n,r,i))}function ee(e,t){let n=e.length-1,r=[e[0]];return F(e,0,n,t,r),r.push(e[n]),r}function I(e,t,n=!1){if(e.length<=2)return e;let r=t===void 0?1:t*t;return e=n?e:P(e,r),e=ee(e,r),e}var L=class{constructor(e){this.drauu=e,this.event=void 0,this.point=void 0,this.start=void 0,this.el=null}onSelected(e){}onUnselected(){}onStart(e){}onMove(e){return!1}onEnd(e){}get brush(){return this.drauu.brush}get shiftPressed(){return this.drauu.shiftPressed}get altPressed(){return this.drauu.altPressed}get svgElement(){return this.drauu.el}getMousePosition(e){let t=this.drauu.el,n=this.drauu.options.cssZoom??1,r=this.drauu.options.coordinateScale??1,i=this.drauu.options.offset??{x:0,y:0};if(this.drauu.options.coordinateTransform===!1){let t=this.drauu.el.getBoundingClientRect();return{x:(e.pageX/n-t.left+i.x)*r,y:(e.pageY/n-t.top+i.y)*r,pressure:e.pressure}}else{let a=this.drauu.svgPoint;a.x=e.clientX/n+i.x,a.y=e.clientY/n+i.y;let o=a.matrixTransform(t.getScreenCTM()?.inverse());return{x:o.x*r,y:o.y*r,pressure:e.pressure}}}createElement(e,t){let n=document.createElementNS(`http://www.w3.org/2000/svg`,e),r=t?w(w({},this.brush),t):this.brush;return n.setAttribute(`fill`,r.fill??`transparent`),n.setAttribute(`stroke`,r.color),n.setAttribute(`stroke-width`,r.size.toString()),n.setAttribute(`stroke-linecap`,`round`),r.dasharray&&n.setAttribute(`stroke-dasharray`,r.dasharray),n}attr(e,t){this.el.setAttribute(e,typeof t==`string`?t:t.toFixed(A))}_setEvent(e){this.event=e,this.point=this.getMousePosition(e)}_eventDown(e){return this._setEvent(e),this.start=this.point,this.onStart(this.point)}_eventMove(e){return this._setEvent(e),this.onMove(this.point)}_eventUp(e){return this._setEvent(e),this.onEnd(this.point)}},R=class e extends L{constructor(){super(...arguments),this.points=[],this.count=0}onStart(e){if(this.el=this.createElement(`path`,{fill:`transparent`}),this.points=[e],this.brush.arrowEnd){this.arrowId=k();let e=j(this.arrowId,this.brush.color);this.el.appendChild(e)}return this.el}onMove(t){return this.el||this.onStart(t),this.points[this.points.length-1]!==t&&(this.points.push(t),this.count+=1),this.count>5&&(this.points=I(this.points,1,!0),this.count=0),this.attr(`d`,e.toSvgData(this.points)),!0}onEnd(){let t=this.el;if(this.el=null,!t)return!1;if(t.setAttribute(`d`,e.toSvgData(I(this.points,1,!0))),!t.getTotalLength()){let{x:e,y:n}=this.points[0],r=this.brush.size/2;t.setAttribute(`d`,`M ${e-r} ${n} a ${r},${r} 0 1,0 ${r*2},0 a ${r},${r} 0 1,0 ${-r*2},0`),t.setAttribute(`fill`,this.brush.color),t.setAttribute(`stroke-width`,`0`)}return!0}static line(e,t){let n=t.x-e.x,r=t.y-e.y;return{length:Math.sqrt(n**2+r**2),angle:Math.atan2(r,n)}}static controlPoint(t,n,r,i){let a=n||t,o=r||t,s=e.line(a,o),c=s.angle+(i?Math.PI:0),l=s.length*.2;return{x:t.x+Math.cos(c)*l,y:t.y+Math.sin(c)*l}}static bezierCommand(t,n,r){let i=e.controlPoint(r[n-1],r[n-2],t),a=e.controlPoint(t,r[n-1],r[n+1],!0);return`C ${i.x.toFixed(A)},${i.y.toFixed(A)} ${a.x.toFixed(A)},${a.y.toFixed(A)} ${t.x.toFixed(A)},${t.y.toFixed(A)}`}static toSvgData(t){return t.reduce((t,n,r,i)=>r===0?`M ${n.x.toFixed(A)},${n.y.toFixed(A)}`:`${t} ${e.bezierCommand(n,r,i)}`,``)}},te=class extends L{onStart(e){return this.el=this.createElement(`ellipse`),this.attr(`cx`,e.x),this.attr(`cy`,e.y),this.el}onMove(e){if(!this.el||!this.start)return!1;let[t,n]=O(e.x-this.start.x),[r,i]=O(e.y-this.start.y);if(this.shiftPressed){let e=Math.min(t,r);t=e,r=e}if(this.altPressed)this.attr(`cx`,this.start.x),this.attr(`cy`,this.start.y),this.attr(`rx`,t),this.attr(`ry`,r);else{let[e,a]=[this.start.x,this.start.x+t*n].sort(E),[o,s]=[this.start.y,this.start.y+r*i].sort(E);this.attr(`cx`,(e+a)/2),this.attr(`cy`,(o+s)/2),this.attr(`rx`,(a-e)/2),this.attr(`ry`,(s-o)/2)}return!0}onEnd(){let e=this.el;if(this.el=null,!e)return!1;try{if(!e.getTotalLength())return!1}catch{return!1}return!0}},ne=class extends L{constructor(){super(...arguments),this.pathSubFactor=20,this.pathFragments=[],this._erased=[]}onSelected(e){let t=(e,n)=>{if(e&&e.length)for(let r=0;r<e.length;r++){let i=e[r];if(i.getTotalLength){let e=i.getTotalLength();for(let t=0;t<this.pathSubFactor;t++){let r=i.getPointAtLength(e*t/this.pathSubFactor),a=i.getPointAtLength(e*(t+1)/this.pathSubFactor);this.pathFragments.push({x1:r.x,x2:a.x,y1:r.y,y2:a.y,segment:t,element:n||i})}}else i.children&&t(i.children,i)}};e&&t(e.children)}onUnselected(){this.pathFragments=[]}onStart(e){this.svgPointPrevious=this.svgElement.createSVGPoint(),this.svgPointPrevious.x=e.x,this.svgPointPrevious.y=e.y}onMove(e){this.svgPointCurrent=this.svgElement.createSVGPoint(),this.svgPointCurrent.x=e.x,this.svgPointCurrent.y=e.y;let t=this.checkAndEraseElement();return this.svgPointPrevious=this.svgPointCurrent,t}onEnd(){this.svgPointPrevious=void 0,this.svgPointCurrent=void 0;let e=this._erased;return this._erased=[],{undo:()=>e.forEach(e=>this.drauu._restoreNode(e)),redo:()=>e.forEach(e=>this.drauu._removeNode(e))}}checkAndEraseElement(){if(this.pathFragments.length)for(let e=0;e<this.pathFragments.length;e++){let t=this.pathFragments[e];if(this.svgPointPrevious&&this.svgPointCurrent){let e={x1:this.svgPointPrevious.x,x2:this.svgPointCurrent.x,y1:this.svgPointPrevious.y,y2:this.svgPointCurrent.y};this.lineLineIntersect(t,e)&&(this.drauu._removeNode(t.element),this._erased.push(t.element))}}return this._erased.length&&(this.pathFragments=this.pathFragments.filter(e=>!this._erased.includes(e.element))),this._erased.length>0}lineLineIntersect(e,t){let n=e.x1,r=e.x2,i=t.x1,a=t.x2,o=e.y1,s=e.y2,c=t.y1,l=t.y2,u=(n-r)*(c-l)-(o-s)*(i-a),d=(n*s-o*r)*(i-a)-(n-r)*(i*l-c*a),f=(n*s-o*r)*(c-l)-(o-s)*(i*l-c*a),p=(e,t,n)=>e>=t&&e<=n?!0:e>=n&&e<=t;if(u===0)return!1;{let e={x:d/u,y:f/u};return p(e.x,n,r)&&p(e.y,o,s)&&p(e.x,i,a)&&p(e.y,c,l)}}},re=class extends L{onStart(e){if(this.el=this.createElement(`line`,{fill:`transparent`}),this.attr(`x1`,e.x),this.attr(`y1`,e.y),this.attr(`x2`,e.x),this.attr(`y2`,e.y),this.brush.arrowEnd){let e=k(),t=document.createElementNS(`http://www.w3.org/2000/svg`,`g`);return t.append(j(e,this.brush.color)),t.append(this.el),this.attr(`marker-end`,`url(#${e})`),t}return this.el}onMove(e){if(!this.el)return!1;let{x:t,y:n}=e;if(this.shiftPressed){let r=e.x-this.start.x,i=e.y-this.start.y;if(i!==0){let e=r/i;e=Math.round(e),Math.abs(e)<=1?(t=this.start.x+i*e,n=this.start.y+i):(t=this.start.x+r,n=this.start.y)}}return this.altPressed?(this.attr(`x1`,this.start.x*2-t),this.attr(`y1`,this.start.y*2-n),this.attr(`x2`,t),this.attr(`y2`,n)):(this.attr(`x1`,this.start.x),this.attr(`y1`,this.start.y),this.attr(`x2`,t),this.attr(`y2`,n)),!0}onEnd(){let e=this.el;if(this.el=null,!e)return!1;try{if(e.getTotalLength()<5)return!1}catch{return!1}return!0}},ie=class extends L{onStart(e){return this.el=this.createElement(`rect`),this.brush.cornerRadius&&(this.attr(`rx`,this.brush.cornerRadius),this.attr(`ry`,this.brush.cornerRadius)),this.attr(`x`,e.x),this.attr(`y`,e.y),this.el}onMove(e){if(!this.el||!this.start)return!1;let[t,n]=O(e.x-this.start.x),[r,i]=O(e.y-this.start.y);if(this.shiftPressed){let e=Math.min(t,r);t=e,r=e}if(this.altPressed)this.attr(`x`,this.start.x-t),this.attr(`y`,this.start.y-r),this.attr(`width`,t*2),this.attr(`height`,r*2);else{let[e,a]=[this.start.x,this.start.x+t*n].sort(E),[o,s]=[this.start.y,this.start.y+r*i].sort(E);this.attr(`x`,e),this.attr(`y`,o),this.attr(`width`,a-e),this.attr(`height`,s-o)}return!0}onEnd(){let e=this.el;if(this.el=null,!e)return!1;try{if(!e.getTotalLength())return!1}catch{return!1}return!0}};function z(e,t,n,r=e=>e){return e*r(.5-t*(.5-n))}function ae(e){return[-e[0],-e[1]]}function B(e,t){return[e[0]+t[0],e[1]+t[1]]}function V(e,t){return[e[0]-t[0],e[1]-t[1]]}function H(e,t){return[e[0]*t,e[1]*t]}function oe(e,t){return[e[0]/t,e[1]/t]}function U(e){return[e[1],-e[0]]}function W(e,t){return e[0]*t[0]+e[1]*t[1]}function se(e,t){return e[0]===t[0]&&e[1]===t[1]}function ce(e){return Math.hypot(e[0],e[1])}function le(e){return e[0]*e[0]+e[1]*e[1]}function G(e,t){return le(V(e,t))}function K(e){return oe(e,ce(e))}function ue(e,t){return Math.hypot(e[1]-t[1],e[0]-t[0])}function q(e,t,n){let r=Math.sin(n),i=Math.cos(n),a=e[0]-t[0],o=e[1]-t[1],s=a*i-o*r,c=a*r+o*i;return[s+t[0],c+t[1]]}function J(e,t,n){return B(e,H(V(t,e),n))}function Y(e,t,n){return B(e,H(t,n))}var{min:X,PI:Z}=Math,Q=.275,$=Z+1e-4;function de(e,t={}){let{size:n=16,smoothing:r=.5,thinning:i=.5,simulatePressure:a=!0,easing:o=e=>e,start:s={},end:c={},last:l=!1}=t,{cap:u=!0,easing:d=e=>e*(2-e)}=s,{cap:f=!0,easing:p=e=>--e*e*e+1}=c;if(e.length===0||n<=0)return[];let m=e[e.length-1].runningLength,h=s.taper===!1?0:s.taper===!0?Math.max(n,m):s.taper,g=c.taper===!1?0:c.taper===!0?Math.max(n,m):c.taper,_=(n*r)**2,v=[],y=[],b=e.slice(0,10).reduce((e,t)=>{let r=t.pressure;if(a){let i=X(1,t.distance/n);r=X(1,e+(X(1,1-i)-e)*(i*Q))}return(e+r)/2},e[0].pressure),x=z(n,i,e[e.length-1].pressure,o),S,C=e[0].vector,w=e[0].point,T=w,E=w,D=T,O=!1;for(let t=0;t<e.length;t++){let{pressure:r}=e[t],{point:s,vector:c,distance:l,runningLength:u}=e[t];if(t<e.length-1&&m-u<3)continue;if(i){if(a){let e=X(1,l/n),t=X(1,1-e);r=X(1,b+(t-b)*(e*Q))}x=z(n,i,r,o)}else x=n/2;S===void 0&&(S=x);let f=u<h?d(u/h):1,k=m-u<g?p((m-u)/g):1;x=Math.max(.01,x*Math.min(f,k));let A=(t<e.length-1?e[t+1]:e[t]).vector,j=t<e.length-1?W(c,A):1,M=W(c,C)<0&&!O,N=j!==null&&j<0;if(M||N){let e=H(U(C),x);for(let t=0;t<=1;t+=.07692307692307693)E=q(V(s,e),s,$*t),v.push(E),D=q(B(s,e),s,$*-t),y.push(D);w=E,T=D,N&&(O=!0);continue}if(O=!1,t===e.length-1){let e=H(U(c),x);v.push(V(s,e)),y.push(B(s,e));continue}let P=H(U(J(A,c,j)),x);E=V(s,P),(t<=1||G(w,E)>_)&&(v.push(E),w=E),D=B(s,P),(t<=1||G(T,D)>_)&&(y.push(D),T=D),b=r,C=c}let k=e[0].point.slice(0,2),A=e.length>1?e[e.length-1].point.slice(0,2):B(e[0].point,[1,1]),j=[],M=[];if(e.length===1){if(!(h||g)||l){let e=Y(k,K(U(V(k,A))),-(S||x)),t=[];for(let n=1/13,r=n;r<=1;r+=n)t.push(q(e,k,$*2*r));return t}}else{if(!(h||g&&e.length===1))if(u)for(let e=1/13,t=e;t<=1;t+=e){let e=q(y[0],k,$*t);j.push(e)}else{let e=V(v[0],y[0]),t=H(e,.5),n=H(e,.51);j.push(V(k,t),V(k,n),B(k,n),B(k,t))}let t=U(ae(e[e.length-1].vector));if(g||h&&e.length===1)M.push(A);else if(f){let e=Y(A,t,x);for(let t=1/29,n=t;n<1;n+=t)M.push(q(e,A,$*3*n))}else M.push(B(A,H(t,x)),B(A,H(t,x*.99)),V(A,H(t,x*.99)),V(A,H(t,x)))}return v.concat(M,y.reverse(),j)}function fe(e,t={}){let{streamline:n=.5,size:r=16,last:i=!1}=t;if(e.length===0)return[];let a=.15+(1-n)*.85,o=Array.isArray(e[0])?e:e.map(({x:e,y:t,pressure:n=.5})=>[e,t,n]);if(o.length===2){let e=o[1];o=o.slice(0,-1);for(let t=1;t<5;t++)o.push(J(o[0],e,t/4))}o.length===1&&(o=[...o,[...B(o[0],[1,1]),...o[0].slice(2)]]);let s=[{point:[o[0][0],o[0][1]],pressure:o[0][2]>=0?o[0][2]:.25,vector:[1,1],distance:0,runningLength:0}],c=!1,l=0,u=s[0],d=o.length-1;for(let e=1;e<o.length;e++){let t=i&&e===d?o[e].slice(0,2):J(u.point,o[e],a);if(se(u.point,t))continue;let n=ue(t,u.point);if(l+=n,e<d&&!c){if(l<r)continue;c=!0}u={point:t,pressure:o[e][2]>=0?o[e][2]:.5,vector:K(V(u.point,t)),distance:n,runningLength:l},s.push(u)}return s[0].vector=s[1]?.vector||[0,0],s}function pe(e,t={}){return de(fe(e,t),t)}var me=class e extends L{constructor(){super(...arguments),this.points=[]}onStart(e){return this.el=document.createElementNS(`http://www.w3.org/2000/svg`,`path`),this.points=[e],this.attr(`fill`,this.brush.color),this.attr(`d`,this.getSvgData(this.points)),this.el}onMove(e){return this.el||this.onStart(e),this.points[this.points.length-1]!==e&&this.points.push(e),this.attr(`d`,this.getSvgData(this.points)),!0}onEnd(){let e=this.el;return this.el=null,!!e}getSvgData(t){return e.getSvgData(t,this.brush)}static getSvgData(e,t){let n=pe(e,w({size:t.size,thinning:.9,simulatePressure:!1,start:{taper:5},end:{taper:5}},t.stylusOptions));if(!n.length)return``;let r=n.reduce((e,[t,n],r,i)=>{let[a,o]=i[(r+1)%i.length];return e.push(t,n,(t+a)/2,(n+o)/2),e},[`M`,...n[0],`Q`]);return r.push(`Z`),r.map(e=>typeof e==`number`?e.toFixed(2):e).join(` `)}};function he(e){return{draw:new R(e),stylus:new me(e),line:new re(e),rectangle:new ie(e),ellipse:new te(e),eraseLine:new ne(e)}}var ge=class{constructor(e={}){this.options=e,this.el=null,this.svgPoint=null,this.eventEl=null,this.shiftPressed=!1,this.altPressed=!1,this.drawing=!1,this._emitter=T(),this._originalPointerId=null,this._models=he(this),this._opStack=[],this._opIndex=0,this._disposables=[],this._elements=[],this.options.brush||(this.options.brush={color:`black`,size:3,mode:`stylus`}),e.el&&this.mount(e.el,e.eventTarget,e.window)}get model(){return this._models[this.mode]}get mounted(){return!!this.el}get mode(){return this.options.brush.mode||`stylus`}set mode(e){this._models[this.mode].onUnselected(),this.options.brush.mode=e,this.model.onSelected(this.el)}get brush(){return this.options.brush}set brush(e){this.options.brush=e}resolveSelector(e){return typeof e==`string`?document.querySelector(e):e||null}mount(e,t,n=window){if(this.el)throw Error(`[drauu] already mounted, unmount previous target first`);if(this.el=this.resolveSelector(e),!this.el)throw Error(`[drauu] target element not found`);if(this.el.tagName.toLocaleLowerCase()!==`svg`)throw Error(`[drauu] can only mount to a SVG element`);if(!this.el.createSVGPoint)throw Error(`[drauu] SVG element must be create by document.createElementNS('http://www.w3.org/2000/svg', 'svg')`);this.svgPoint=this.el.createSVGPoint();let r=this.resolveSelector(t)||this.el,i=this.eventStart.bind(this),a=this.eventMove.bind(this),o=this.eventEnd.bind(this),s=this.eventKeyboard.bind(this);r.addEventListener(`pointerdown`,i,{passive:!1}),n.addEventListener(`pointermove`,a,{passive:!1}),n.addEventListener(`pointerup`,o,{passive:!1}),n.addEventListener(`pointercancel`,o,{passive:!1}),n.addEventListener(`keydown`,s,!1),n.addEventListener(`keyup`,s,!1),this._disposables.push(()=>{r.removeEventListener(`pointerdown`,i),n.removeEventListener(`pointermove`,a),n.removeEventListener(`pointerup`,o),n.removeEventListener(`pointercancel`,o),n.removeEventListener(`keydown`,s,!1),n.removeEventListener(`keyup`,s,!1)}),this._emitter.emit(`mounted`)}unmount(){this._disposables.forEach(e=>e()),this._disposables.length=0,this._elements.length=0,this.el=null,this._emitter.emit(`unmounted`)}on(e,t){return this._emitter.on(e,t)}undo(){return!this.canUndo()||this.drawing?!1:(this._opStack[--this._opIndex].undo(),this._emitter.emit(`changed`),!0)}redo(){return!this.canRedo()||this.drawing?!1:(this._opStack[this._opIndex++].redo(),this._emitter.emit(`changed`),!0)}canRedo(){return this._opIndex<this._opStack.length}canUndo(){return this._opIndex>0}eventMove(e){!this.acceptsInput(e)||!this.drawing||this.model._eventMove(e)&&(e.stopPropagation(),e.preventDefault(),this._emitter.emit(`changed`))}eventStart(e){this.acceptsInput(e)&&(e.stopPropagation(),e.preventDefault(),this._currentNode&&this.cancel(),this.drawing=!0,this._originalPointerId=e.pointerId,this._emitter.emit(`start`),this._currentNode=this.model._eventDown(e),this._currentNode&&this.mode!==`eraseLine`&&this.el.appendChild(this._currentNode),this._emitter.emit(`changed`))}eventEnd(e){if(!this.acceptsInput(e)||!this.drawing)return;let t=this.model._eventUp(e);if(!t)this.cancel();else if(t===!0){let e=this._currentNode;e&&(this._appendNode(e),this.commit({undo:()=>this._removeNode(e),redo:()=>this._restoreNode(e)}))}else this.commit(t);this.drawing=!1,this._emitter.emit(`end`),this._emitter.emit(`changed`),this._originalPointerId=null}acceptsInput(e){return(!this.options.acceptsInputTypes||this.options.acceptsInputTypes.includes(e.pointerType))&&!(this._originalPointerId&&this._originalPointerId!==e.pointerId)}eventKeyboard(e){this.shiftPressed===e.shiftKey&&this.altPressed===e.altKey||(this.shiftPressed=e.shiftKey,this.altPressed=e.altKey,this.model.point&&this.model.onMove(this.model.point)&&this._emitter.emit(`changed`))}commit(e){this._opStack.length=this._opIndex,this._opStack.push(e),this._opIndex++;let t=this._currentNode;this._currentNode=void 0,this._emitter.emit(`committed`,t)}clear(){this._opStack.length=0,this._opIndex=0,this._elements=[],this.cancel(),this.el.innerHTML=``,this._emitter.emit(`changed`)}cancel(){this._currentNode&&(this.el.removeChild(this._currentNode),this._currentNode=void 0,this._emitter.emit(`canceled`))}dump(){return this.el.innerHTML}load(e){this.clear(),this.el.innerHTML=e}_appendNode(e){let t=this._elements.at(-1);t?t.after(e):this.el.append(e);let n=this._elements.push(e)-1;e.dataset.drauu_index=n.toString()}_removeNode(e){e.remove(),this._elements[+e.dataset.drauu_index]=null}_restoreNode(e){let t=+e.dataset.drauu_index;this._elements[t]=e;for(let n=t-1;n>=0;n--){let t=this._elements[n];if(t){t.after(e);return}}this.el.prepend(e)}};function _e(e){return new ge(e)}function ve(t,n){let r=d(),i=[],a=h(),o=h(),s=h(),c=h(),l=h(),u=p(!1),f=p(!1),g=p(!1),v=p(!1),y=d({color:`black`,size:3,arrowEnd:!1,cornerRadius:0,dasharray:void 0,fill:`transparent`,mode:`draw`,...n?.brush});e(y,()=>{let e=r.value;e&&(e.brush=y.value,e.mode=y.value.mode)},{deep:!0});let b=()=>r.value?.undo(),x=()=>r.value?.redo(),S=()=>r.value?.clear(),C=()=>r.value?.cancel(),w=e=>r.value?.load(e),T=()=>r.value?.dump(),E=()=>{i.forEach(e=>e()),r.value?.unmount()},D=()=>{r.value&&(u.value=r.value.canUndo(),f.value=r.value.canRedo(),g.value=r.value.altPressed,v.value=r.value.shiftPressed)};return e(()=>_(t),e=>{!e||typeof SVGSVGElement>`u`||!(e instanceof SVGSVGElement)||(r.value&&E(),r.value=_e({el:e,...n}),D(),i=[r.value.on(`canceled`,()=>o.trigger()),r.value.on(`committed`,e=>s.trigger(e)),r.value.on(`start`,()=>c.trigger()),r.value.on(`end`,()=>l.trigger()),r.value.on(`changed`,()=>{D(),a.trigger()})])},{flush:`post`}),m(()=>E()),{drauuInstance:r,load:w,dump:T,clear:S,cancel:C,undo:b,redo:x,canUndo:u,canRedo:f,brush:y,onChanged:a.on,onCommitted:s.on,onStart:c.on,onEnd:l.on,onCanceled:o.on}}var ye={flex:`~ col`,place:`items-center`},be={shadow:`~ lg`,class:`drauu-demo`,border:`rounded`,overflow:`hidden`,"max-w":`screen-lg`,h:`[60vh]`,w:`full`,flex:`~ col`},xe={bg:`$vp-c-bg`,border:`1 $vp-c-divider`,"rounded-t":``,flex:`~ row`,items:`center`,p:`2`,space:`x-4`},Se={flex:`~ row 1`},Ce=[`onClick`],we={flex:`~ row 1 shrink-1`,items:`center`,w:`full`,"max-w":`64`},Te={flex:`~ row 1`,justify:`end`},Ee=[`disabled`],De=[`disabled`],Oe={flex:`~ row 1`,h:`72`},ke={bg:`$vp-c-bg`,border:`t-0 1 $vp-c-divider`,"rounded-b":``,flex:`~ col`,space:`y-2`,place:`items-center`,p:`2`},Ae=o({__name:`demo.client`,setup(e){let o=d([`black`,`#ef4444`,`#22c55e`,`#3b82f6`]),p=d(),{undo:m,redo:h,canUndo:_,canRedo:y,clear:b,brush:x}=ve(p,{brush:{color:`black`,size:3}}),{mode:S,color:C,size:w}=g(x);return(e,d)=>(i(),t(`div`,ye,[c(`div`,be,[c(`div`,xe,[c(`div`,Se,[(i(!0),t(u,null,a(o.value,e=>(i(),t(`button`,{key:e,class:s([{active:e===f(C)},`color-button`]),m:`r-1`,onClick:()=>C.value=e},[c(`div`,{style:n({background:e}),w:`6`,h:`6`,border:`2 dark:light-900 dark:opacity-50 rounded-full`},null,4)],10,Ce))),128))]),c(`div`,we,[d[8]||=c(`i`,{"i-carbon-paint-brush":``,m:`r-2`},null,-1),r(v,{modelValue:f(w),"onUpdate:modelValue":d[0]||=e=>l(w)?w.value=e:null,w:`full`,min:1,max:10},null,8,[`modelValue`])]),c(`div`,Te,[c(`button`,{class:`tool-button`,disabled:!f(_),onClick:d[1]||=e=>f(m)()},[...d[9]||=[c(`i`,{"i-carbon-undo":``},null,-1)]],8,Ee),c(`button`,{class:`tool-button`,disabled:!f(y),onClick:d[2]||=e=>f(h)()},[...d[10]||=[c(`i`,{"i-carbon-redo":``},null,-1)]],8,De),c(`button`,{class:`tool-button`,onClick:d[3]||=e=>f(b)()},[...d[11]||=[c(`i`,{"i-carbon-clean":``},null,-1)]])])]),c(`div`,Oe,[c(`div`,ke,[c(`button`,{class:s([{active:f(x).mode===`draw`},`tool-button`]),onClick:d[4]||=e=>S.value=`draw`},[...d[12]||=[c(`i`,{"i-carbon-pen":``},null,-1)]],2),c(`button`,{class:s([{active:f(x).mode===`line`&&!f(x).arrowEnd},`tool-button`]),onClick:d[5]||=e=>S.value=`line`},[...d[13]||=[c(`i`,{"i-mdi-slash-forward":``},null,-1)]],2),c(`button`,{class:s([{active:f(x).mode===`rectangle`},`tool-button`]),onClick:d[6]||=e=>S.value=`rectangle`},[...d[14]||=[c(`i`,{"i-carbon-checkbox":``},null,-1)]],2),c(`button`,{class:s([{active:f(x).mode===`ellipse`},`tool-button`]),onClick:d[7]||=e=>S.value=`ellipse`},[...d[15]||=[c(`i`,{"i-mdi-light-shape-circle":``},null,-1)]],2)]),(i(),t(`svg`,{ref_key:`target`,ref:p,w:`full`,h:`full`,bg:`white`},null,512))])])]))}});export{Ae as default};