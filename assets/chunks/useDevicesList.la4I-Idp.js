import{gt as e,y as t,yt as n}from"./vue.CAJL2k56.js";import{t as r}from"./useEventListener.c80kvxRv.js";import{n as i}from"./configurable.CHIFr4yg.js";import{t as a}from"./useSupported.wZzSDbHl.js";import{t as o}from"./usePermission.BTadhBq-.js";function s(s={}){let{navigator:c=i,requestPermissions:l=!1,constraints:u={audio:!0,video:!0},onUpdated:d}=s,f=e([]),p=t(()=>f.value.filter(e=>e.kind===`videoinput`)),m=t(()=>f.value.filter(e=>e.kind===`audioinput`)),h=t(()=>f.value.filter(e=>e.kind===`audiooutput`)),g=a(()=>c&&c.mediaDevices&&c.mediaDevices.enumerateDevices),_=n(!1),v;async function y(){g.value&&(f.value=await c.mediaDevices.enumerateDevices(),d?.(f.value),v&&=(v.getTracks().forEach(e=>e.stop()),null))}async function b(){let e=u.video?`camera`:`microphone`;if(!g.value)return!1;if(_.value)return!0;let{state:t,query:n}=o(e,{controls:!0});if(await n(),t.value!==`granted`){let e=!0;try{let e=await c.mediaDevices.enumerateDevices(),t=e.some(e=>e.kind===`videoinput`),n=e.some(e=>e.kind===`audioinput`||e.kind===`audiooutput`);u.video=t?u.video:!1,u.audio=n?u.audio:!1,v=await c.mediaDevices.getUserMedia(u)}catch{v=null,e=!1}y(),_.value=e}else _.value=!0;return _.value}return g.value&&(l&&b(),r(c.mediaDevices,`devicechange`,y,{passive:!0}),y()),{devices:f,ensurePermissions:b,permissionGranted:_,videoInputs:p,audioInputs:m,audioOutputs:h,isSupported:g}}export{s as t};